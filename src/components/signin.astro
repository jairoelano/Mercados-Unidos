<!-- Contenido de la página (antes de abrir el modal) -->
<div id="contenido-principal" aria-hidden="false">
    <!-- Aquí va todo tu contenido -->
</div>

<!-- Modal (contenido principal del modal) -->
<div id="popup-reseñas" tabindex="-1" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-auto max-h-full" aria-hidden="true">
    <div class="relative p-5 w-full max-w-md h-auto bg-gray-950/70 rounded-md">
        <div class="relative rounded-lg border border-gray-500">
            <button type="button" class="absolute top-3 end-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="popup-reseñas">
                <svg class="w-3 h-3" aria-hidden="false" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                </svg>
                <span class="sr-only">Close modal</span>
           </button>

            <div class="w-full max-w-sm rounded-lg p-3">
              <div class="flex flex-col items-center gap-2 rounded-lg pb-10">
                  <img src="/IMGs/logo.png" class="hover:shadow-gray-700 w-25 h-25 mb-5 mt-10 bg-transparent border border-gray-600 shadow-gray-950 rounded-full shadow-lg" src="/docs/images/people/profile-picture-3.jpg" alt="logo"/>
                  <h4 class="mt-3 text-3xl font-medium text-white">Inicia Sesión</h4> 
                  <div class="flex mt-5 w-56 justify-center items-center gap-2">
                    <button id="login-google" class="cursor-pointer bg-gray-300/70 rounded-md p-3 shadow-gray-950 shadow-md hover:shadow-gray-800">
                      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><path fill="#ffc107" d="M43.611 20.083H42V20H24v8h11.303c-1.649 4.657-6.08 8-11.303 8c-6.627 0-12-5.373-12-12s5.373-12 12-12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4C12.955 4 4 12.955 4 24s8.955 20 20 20s20-8.955 20-20c0-1.341-.138-2.65-.389-3.917"/><path fill="#ff3d00" d="m6.306 14.691l6.571 4.819C14.655 15.108 18.961 12 24 12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4C16.318 4 9.656 8.337 6.306 14.691"/><path fill="#4caf50" d="M24 44c5.166 0 9.86-1.977 13.409-5.192l-6.19-5.238A11.9 11.9 0 0 1 24 36c-5.202 0-9.619-3.317-11.283-7.946l-6.522 5.025C9.505 39.556 16.227 44 24 44"/><path fill="#1976d2" d="M43.611 20.083H42V20H24v8h11.303a12.04 12.04 0 0 1-4.087 5.571l.003-.002l6.19 5.238C36.971 39.205 44 34 44 24c0-1.341-.138-2.65-.389-3.917"/></svg>
                    </button>
                    <button id="login-twitter" class="cursor-pointer mx-2 rounded-md border-3 border-black p-3 shadow-gray-950 shadow-md hover:shadow-gray-900 hover:border-black/70">
                      <svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 14 14" class="hover:opacity-60">
                        <g fill="none"><path fill="#000" d="M11.025.656h2.147L8.482 6.03L14 13.344H9.68L6.294 8.909l-3.87 4.435H.275l5.016-5.75L0 .657h4.43L7.486 4.71zm-.755 11.4h1.19L3.78 1.877H2.504z"/></g>
                      </svg>
                    </button>
                    <button id="login-facebook" class="cursor-pointer rounded-md bg-gray-400/90 p-1 shadow-gray-950 shadow-md hover:shadow-gray-800">
                      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" class="p-0 hover:opacity-60">
                        <path fill="#3275B5" d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3v3h-3v6.95c5.05-.5 9-4.76 9-9.95"/>
                      </svg>
                    </button>
                  </div>
              </div>
            </div>
        </div>
    </div>
</div>



<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, TwitterAuthProvider, FacebookAuthProvider } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";

    const firebaseConfig = {
    apiKey: "AIzaSyDavU9YjgE1MM8buptQ1hOOoohrsMOriCs",
    authDomain: "comercios-unidos-se.firebaseapp.com",
    projectId: "comercios-unidos-se",
    storageBucket: "comercios-unidos-se.firebasestorage.app",
    messagingSenderId: "561779340978",
    appId: "1:561779340978:web:dfdf091ddec7db324dfbab"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const googleProvider = new GoogleAuthProvider();
    const twitterProvider = new TwitterAuthProvider();
    const facebookProvider = new FacebookAuthProvider();

   // Función para cerrar el modal
    function closeModal() {
    // Encuentra el botón de cerrar modal (que tiene el atributo data-modal-hide)
    const closeButton = document.querySelector('[data-modal-hide="popup-reseñas"]');
    if (closeButton) {
    closeButton.click(); // Simula el clic en el botón para cerrar el modal
    }
    }  


    // Manejo del login de Google
    document.getElementById("login-google").addEventListener("click", () => {
    signInWithPopup(auth, googleProvider).then(result => {
        console.log("Google login exitoso:", result.user);
        localStorage.setItem('isLoggedIn', 'true'); // Guardamos el estado de login
        console.log('Estado de login guardado en localStorage:', localStorage.getItem('isLoggedIn'));
        
        const username = result.user.displayName;  
        
        window.history.pushState({}, '', `?username=${encodeURIComponent(username)}`);

        closeModal()

        window.location.reload('/');

        alert("¡Login Exitoso! Bienvenido 🤗. Ahora puedes publicar.");
        }).catch(error => {
        console.error("Error en Google login:", error);

        if (error.code === "auth/network-request-failed") {
        alert("Error de conexión. Intenta nuevamente.");
      } else {
        alert("Error al iniciar sesión. Hubo un problema de conexión.");
      }
        });
    });


    // Manejo del login de Twitter
    document.getElementById("login-twitter").addEventListener("click", () => {
        signInWithPopup(auth, twitterProvider).then(result => {
            console.log("Twitter login exitoso:", result.user);
            localStorage.setItem('isLoggedIn', 'true');
            closeModal();
            alert('¡Login Exitoso!')
        }).catch(error => {
            console.error("Error en Twitter login:", error);
        });
    });

    // Manejo del login de Facebook
    document.getElementById("login-facebook").addEventListener("click", () => {
        signInWithPopup(auth, facebookProvider).then(result => {
            console.log("Facebook login exitoso:", result.user);
            localStorage.setItem('isLoggedIn', 'true');
            closeModal();
            alert('¡Login Exitoso!')
        }).catch(error => {
            console.error("Error en Facebook login:", error);
        });


    });
</script>

